# QA-TESTING-EXPERT Playbook

> 角色定义、输入输出与 DoD 见 `/AgentRoles/QA-TESTING-EXPERT.md`。

## 作业流程

### 4.1 测试策略制定阶段
- **需求分析**：基于 PRD 与架构识别测试范围、质量目标。
- **测试类型确定**：列出所需执行的测试类型及覆盖标准。
- **环境规划**：确认测试环境拓扑、账户、数据准备方案。
- **风险评估**：识别高风险模块，排序先测项目。
- **非功能对齐**：将性能、可靠性、安全性等非功能指标映射为可执行用例，并约定指标阈值与验证方式。

### 4.2 测试计划设计阶段
- **测试用例设计**：为关键场景创建覆盖完整的测试用例。
- **测试数据准备**：编排数据生成与刷新策略，保障隔离。
- **自动化框架选择**：确定 API/UI/性能测试所用工具。
- **验收标准**：定义每种测试类型的入口/出口准则。
- **环境健康检查脚本**：准备部署后/执行前的环境巡检清单，包含日志、监控、依赖可用性。

### 4.3 测试执行阶段
- **测试套件执行**：按优先级运行测试，记录结果与环境信息。
- **缺陷跟踪**：按严重程度／优先级登记缺陷，并保持生命周期同步；登记时校验复现步骤、环境、日志/证据、影响分析、建议回流阶段等字段完整，再同步至 `/docs/QA.md`。
- **进度监控**：实时更新测试执行进度、覆盖率与风险状态。
- **质量评估**：依据结果评估当前系统质量，决定是否继续。
- **证据同步**：保留截图、日志、性能报表、监控链接等证据，附在 `/docs/QA.md` 或外部仓储。

### 4.4 测试报告阶段
- **结果分析**：总结主要缺陷类型与模式。
- **质量度量**：计算覆盖率、缺陷密度等指标。
- **发布建议**：明确"建议发布 / 有条件发布 / 不建议发布"及前置条件。
- **改进建议**：输出流程或质量改进项，供团队回顾。
- **交叉校验**：对照最新 CI 结果、`/docs/qa-modules/CHANGELOG.md`、`/docs/TASK.md` 完成项，确认测试结论一致；若发现不一致，及时发起回流。
- **灰度策略**：高风险变更建议先灰度发布（5%→25%→100%），每阶段完成冒烟测试后再扩量。

### 4.5 部署验证协作
- **发布建议交接**：基于测试结论在 `/docs/QA.md` 记录发布建议，交接 **DevOps 专家**执行部署。
- **部署后验证**：部署后冒烟测试与关键指标监控由 DevOps 独立完成并记录到 `/docs/data/deployments/`，QA 可读取部署记录进行复核确认。
- **灰度监控**：灰度阶段 DevOps 持续监控错误率、延迟、关键业务指标；异常即暂停扩量并执行回滚。
- **异常处理**：若部署后回滚，DevOps 在部署日志中记录回滚事件；QA 被重新激活后从回滚记录中提取信息，在 `defect-log.md` 正式登记缺陷条目，退回 TDD 修复。

---

## 测试类型覆盖标准

### 6.1 集成测试
- **重点**：组件 / 服务接口互操作、数据流、外部依赖。
- **策略**：增量集成（自底向上或自顶向下）、接口功能 + 异常、数据一致性校验。

### 6.2 系统测试
- **重点**：功能完整性、端到端业务流程、关键数据流、不同配置表现。
- **策略**：黑盒功能、场景化测试、跨配置兼容性验证。

### 6.3 E2E 测试
- **重点**：关键用户旅程、跨系统流程、用户体验、业务价值达成。
- **策略**：关键路径优先、仿真环境执行、近真实数据。

### 6.4 冒烟测试
- **重点**：核心功能可用性、部署后基础验证、阻断性缺陷。
- **策略**：快速执行、高优先级覆盖、自动化优先。

### 6.5 非功能测试
- **重点**：峰值/持续性能、资源消耗、扩展性、容错与恢复、安全加固、可观测性。
- **策略**：基于指标基线（延迟、吞吐、错误率等）制定场景；执行性能压测、容量测试、混沌演练、安全扫描；对比结果与阈值，分析偏差并输出整改建议；记录环境配置与监控链接。

---

## 测试设计方法

### 7.1 测试用例设计技术
- 等价类划分、边界值分析、决策表、状态转换、场景用例。

### 7.2 测试数据策略
- 代表性数据覆盖、测试/生产数据隔离、自动化生成、测试后清理。

### 7.3 自动化测试框架
- **测试金字塔**：单元（开发负责）→ 集成 → E2E。
- **工具建议**：Postman/RestAssured/Supertest、Selenium/Cypress/Playwright、JMeter/Gatling/k6、Appium/Espresso/XCUITest。

---

## 缺陷管理流程

### 8.1 分类标准
- **严重程度**：致命 / 严重 / 一般 / 轻微。
- **优先级**：立即 / 高 / 中 / 低。

### 8.2 生命周期
- 新建 → 已分配 → 进行中 → 已修复 → 已验证 → 已关闭（必要时重新打开）。

---

## 输出质量标准
- **测试用例**：可执行、覆盖充分、易维护、相互独立。
- **缺陷报告**：可复现、信息完整、分类准确、生命周期闭环。
- **测试报告**：数据准确、结论明确、建议可行、面向不同受众可裁剪。

---

## 质量度量指标

### 覆盖度指标
- 需求覆盖度 = 已测试需求 / 总需求
- 代码覆盖度 = 执行代码行 / 总代码行
- 功能覆盖度 = 已验证功能点 / 总功能点

### 缺陷质量指标
- 缺陷密度、缺陷消除率、缺陷重开率。

### 测试效率指标
- 测试用例执行率、自动化测试比例、测试执行时间。

---

## 与其他专家的协作

| 协作方 | 输入 | 输出 | 要点 |
|--------|------|------|------|
| PRD | PRD + 追溯矩阵 | 测试覆盖报告 | 按功能域拆分测试计划，确保需求覆盖 |
| ARCH | ARCH + NFR 指标 | NFR 验证结果 | 验证非功能需求（性能、安全、可用性） |
| TASK | TASK + 里程碑 | 测试映射 | Story → AC → Test Case → 任务 ID |
| TDD | QA 缺陷列表 | 代码修复 | 阻塞缺陷立即通知，修复后 QA 复验 |
| DevOps | 发布建议 | 部署执行 | QA 可读取 `/docs/data/deployments/` 复核部署结果；回滚时 QA 登记缺陷 |
