# QA 模块化索引

> **说明**：本目录用于存放按功能域拆分的测试计划与执行记录文档。当主 QA 文档 `/docs/QA.md` 过于庞大时，QA 专家会将其拆分为主从结构，此文件作为模块索引与命名规范指引。

**维护者**：QA 专家
**创建日期**：2025-11-05
**模板版本**：v1.8

---

## 何时需要拆分 QA 文档？

当项目满足以下**任一条件**时，建议采用模块化 QA 文档：

1. **主 QA 文档超过 1000 行**
2. **测试用例数量超过 100 个**
3. **存在多类型测试**（功能、性能、安全、兼容性各 > 10 个用例）
4. **多模块并行测试**（3+ 个功能域独立测试）
5. **长周期项目**（需要分阶段回归测试）

对于小型项目（< 30 个测试用例，单一测试类型），维护单一 `/docs/QA.md` 即可。

---

## 命名规范

### 模块文件命名
- **格式**：`{domain}.md`（使用 kebab-case）
- **示例**：
  - `user-management.md` — 用户管理功能测试计划
  - `payment-system.md` — 支付系统测试计划
  - `notification-service.md` — 通知服务测试计划
  - `performance-testing.md` — 性能测试计划（跨模块）
  - `security-testing.md` — 安全测试计划（跨模块）

### 测试用例 ID 规范
- **格式**：`TC-{MODULE}-{序号}`
- **示例**：
  - `TC-REG-001` — 用户注册功能测试
  - `TC-PAY-012` — 支付确认功能测试
  - `TC-NOTIF-008` — 邮件通知测试
  - `TC-PERF-001` — 首页加载性能测试
  - `TC-SEC-005` — SQL 注入安全测试

### 缺陷 ID 规范
- **格式**：`BUG-{MODULE}-{序号}` 或对接外部缺陷管理系统（如 Jira）
- **示例**：
  - `BUG-USER-001` — 用户注册邮箱验证失败
  - `BUG-PAY-003` — 支付超时未回调
  - `JIRA-PROJ-1234` — 外部缺陷系统引用

---

## 模块清单

> **维护规则**：QA 专家在创建/更新模块时，必须同步更新此表格。

| 模块名称 | 文件路径 | 测试负责人 | 对应 PRD 模块 | 对应 TASK 模块 | 状态 | 最后更新 |
|---------|---------|-----------|--------------|---------------|------|---------|
| （示例）用户管理 | [user-management.md](user-management.md) | @qa-tester-1 | [prd-modules/user-management.md](../prd-modules/user-management.md) | [task-modules/user-management.md](../task-modules/user-management.md) | ✅ 已通过 | 2025-11-05 |
| （示例）支付系统 | [payment-system.md](payment-system.md) | @qa-tester-2 | [prd-modules/payment-system.md](../prd-modules/payment-system.md) | [task-modules/payment-system.md](../task-modules/payment-system.md) | 🔄 测试中 | 2025-11-05 |
| （示例）性能测试 | [performance-testing.md](performance-testing.md) | @qa-perf-lead | - | - | 📝 待启动 | 2025-11-05 |
| （待补充） | - | - | - | - | - | - |

**状态标识说明**：
- ✅ **已通过**：所有测试用例通过，无阻塞缺陷
- 🔄 **测试中**：正在执行测试
- 📝 **待启动**：测试计划已完成，等待执行
- ⚠️ **有风险**：存在 P0/P1 缺陷，需关注
- ❌ **未通过**：存在阻塞缺陷，不可发布

---

## 标准模块 QA 文档结构

每个模块 QA 文档应包含以下章节：

```markdown
# {模块名称}测试计划与执行记录

> **所属功能域**：[链接到对应 PRD 模块] | [链接到对应 TASK 模块]
> **测试负责人**：@qa-tester-xxx
> **状态**：📝 待启动 / 🔄 测试中 / ✅ 已通过
> **最后更新**：YYYY-MM-DD

---

## 1. 测试概述
- **测试目标**：验证本模块功能完整性、性能、安全性
- **测试范围**：覆盖的用户故事（US）与任务（TASK）
- **测试类型**：功能测试、集成测试、性能测试、安全测试等
- **测试环境**：测试环境配置（如 Staging、Pre-Prod）

## 2. 测试策略

### 2.1 测试类型与覆盖率目标
| 测试类型 | 覆盖率目标 | 优先级 | 执行方式 |
|---------|----------|--------|---------|
| 功能测试 | 100% 用户故事 | P0 | 手动 + 自动化 |
| 集成测试 | 100% 接口契约 | P0 | 自动化 |
| 性能测试 | 关键路径 | P1 | 自动化（JMeter/k6） |
| 安全测试 | OWASP Top 10 | P1 | 手动 + 工具扫描 |
| 兼容性测试 | 主流浏览器/设备 | P2 | 手动 |

### 2.2 测试数据准备
- **测试数据来源**：生产数据脱敏 / Mock 数据 / 自动生成
- **数据量要求**：单元测试（小数据集），性能测试（大数据集 > 10,000 条）
- **数据清理**：测试后自动清理/回滚策略

### 2.3 通过/失败标准
- **通过标准**：
  - 所有 P0/P1 测试用例通过
  - 无阻塞（Blocker）或严重（Critical）缺陷
  - 性能指标符合 NFR（非功能需求）
- **失败标准**：
  - 存在 1+ 个阻塞缺陷
  - 性能指标低于 NFR 要求 > 20%
  - 测试覆盖率 < 90%

## 3. 测试用例（功能测试）

### 3.1 测试用例列表
| 用例 ID | 用例名称 | 对应 Story | 对应 AC | 优先级 | 执行方式 | 状态 | 执行人 | 执行日期 | 缺陷 ID |
|---------|---------|-----------|---------|--------|---------|------|--------|---------|---------|
| TC-{MODULE}-001 | {用例名称} | US-{MODULE}-001 | AC-{MODULE}-001-01 | P0 | 自动化 | ✅ Pass | @tester | YYYY-MM-DD | - |
| TC-{MODULE}-002 | {用例名称} | US-{MODULE}-001 | AC-{MODULE}-001-02 | P1 | 手动 | ❌ Fail | @tester | YYYY-MM-DD | BUG-{MODULE}-001 |

**状态标识**：
- ✅ **Pass**：测试通过
- ❌ **Fail**：测试失败（已记录缺陷）
- ⚠️ **Blocked**：因依赖问题无法执行
- ⏸️ **Pending**：待执行
- 🔄 **Retest**：缺陷修复后需重新测试

### 3.2 测试用例详细说明

#### TC-{MODULE}-001: {用例名称}
**前置条件**：
- 用户已登录
- 数据库已初始化测试数据

**测试步骤**：
1. 访问 `/path/to/feature` 页面
2. 输入 `{test_data}`
3. 点击"提交"按钮

**预期结果**：
- 页面显示成功提示
- 数据库中新增记录
- 后台日志无错误

**实际结果**：
- （执行时填写）

**缺陷说明**：
- （如有缺陷，链接到 BUG-{MODULE}-XXX）

## 4. 集成测试

### 4.1 接口测试
| 接口 | 测试场景 | 预期响应 | 状态 | 备注 |
|------|---------|---------|------|------|
| POST /api/v1/user/register | 正常注册 | 200 + userId | ✅ Pass | - |
| POST /api/v1/user/register | 重复邮箱 | 400 + error_code | ✅ Pass | - |
| POST /api/v1/user/register | 无效参数 | 422 + validation_errors | ✅ Pass | - |

### 4.2 契约测试（Consumer/Provider）
- **消费者**：本模块依赖的上游服务接口契约
- **提供者**：本模块提供的下游服务接口契约
- **工具**：Pact / Spring Cloud Contract

## 5. 性能测试（如适用）

### 5.1 性能指标
| 场景 | 并发数 | 目标 TPS | 目标响应时间（P95） | 实际 TPS | 实际响应时间 | 状态 |
|------|--------|---------|---------------------|---------|-------------|------|
| 用户注册 | 100 | 50 TPS | < 500ms | 48 TPS | 520ms | ⚠️ 需优化 |
| 用户登录 | 500 | 200 TPS | < 300ms | 210 TPS | 280ms | ✅ Pass |

### 5.2 性能瓶颈分析
- **瓶颈点**：数据库查询慢（未建立索引）
- **优化建议**：为 `email` 字段添加唯一索引

## 6. 安全测试（如适用）

### 6.1 安全检查清单
| 安全项 | 检查点 | 状态 | 备注 |
|--------|--------|------|------|
| SQL 注入 | 输入参数过滤 | ✅ Pass | 使用参数化查询 |
| XSS 攻击 | 输出转义 | ✅ Pass | React 默认转义 |
| CSRF 防护 | Token 验证 | ✅ Pass | 使用 CSRF Token |
| 密码强度 | 密码策略 | ✅ Pass | 8-20 位，含大小写+数字 |
| 敏感数据 | 加密存储 | ✅ Pass | 使用 bcrypt |

## 7. 缺陷清单

| 缺陷 ID | 缺陷标题 | 严重程度 | 状态 | 发现日期 | 修复负责人 | 修复日期 | 备注 |
|---------|---------|---------|------|---------|-----------|---------|------|
| BUG-{MODULE}-001 | 用户注册邮箱验证失败 | 🔴 Blocker | ✅ Fixed | YYYY-MM-DD | @dev-backend | YYYY-MM-DD | 已重新测试通过 |
| BUG-{MODULE}-002 | 登录页面样式错位 | 🟡 Minor | 🔄 Open | YYYY-MM-DD | @dev-frontend | - | 不影响功能 |

**严重程度标识**：
- 🔴 **Blocker**：阻塞缺陷，完全无法使用
- 🟠 **Critical**：严重缺陷，核心功能受影响
- 🟡 **Major**：主要缺陷，重要功能受影响
- 🟢 **Minor**：次要缺陷，不影响核心功能
- ⚪ **Trivial**：轻微缺陷，UI/文案问题

## 8. 测试总结与建议

### 8.1 测试覆盖率
- **用户故事覆盖率**：10/10 (100%)
- **代码覆盖率**：单元测试 85%，集成测试 90%
- **自动化覆盖率**：70% 用例已自动化

### 8.2 风险评估
- **高风险点**：支付回调超时（BUG-PAY-003），建议增加重试机制
- **中风险点**：性能指标未达标（用户注册场景），建议优化数据库索引
- **低风险点**：UI 样式问题（不影响发布）

### 8.3 发布建议
- ✅ **可发布**：所有 P0/P1 缺陷已修复，性能指标达标
- ⚠️ **有条件发布**：存在 P2 缺陷，建议灰度发布并监控
- ❌ **不可发布**：存在阻塞缺陷，需修复后重新测试

## 9. 变更记录
| 版本 | 日期 | 变更类型 | 变更描述 | 负责人 |
|------|------|---------|---------|--------|
| v0.1 | YYYY-MM-DD | 新增 | 初始版本 | @qa-lead |

---

> **维护说明**：本文档由 QA 专家在 Phase 5 创建并持续维护。测试结果需实时更新，重大缺陷需立即通知 TDD 专家与项目负责人。
```

---

## 跨模块协作规范

### 与 PRD 专家协作
- **输入**：读取 `/docs/prd-modules/{domain}.md` 对应的 PRD 模块
- **追溯**：基于追溯矩阵（`/docs/data/traceability-matrix.md`），确保所有 Story/AC 都有对应测试用例
- **验收标准**：严格按照 PRD 中的 Given-When-Then 验收标准执行测试

### 与 ARCHITECTURE 专家协作
- **输入**：读取 `/docs/architecture-modules/{domain}.md` 对应的架构模块
- **接口测试**：基于架构文档的接口定义，编写契约测试
- **非功能需求**：基于架构文档的 NFR（性能/安全/可用性）制定测试策略

### 与 TASK 专家协作
- **输入**：读取 `/docs/task-modules/{domain}.md` 对应的任务模块
- **测试顺序**：根据任务完成顺序，逐步执行测试
- **阻塞反馈**：若测试发现阻塞缺陷，及时通知 TASK 专家调整计划

### 与 TDD 专家协作
- **缺陷反馈**：通过缺陷清单（或外部缺陷系统）反馈给 TDD 专家
- **重新测试**：TDD 专家修复缺陷后，QA 专家执行回归测试
- **CI 集成**：QA 专家将自动化测试集成到 CI 流水线，提前发现问题

---

## 模块化工作流

1. **拆分评估**：QA 专家根据拆分条件，决定是否采用模块化
2. **创建主 QA 文档**：在 `/docs/QA.md` 维护总纲与模块索引（< 500 行）
3. **创建模块 QA 文档**：在本目录下创建 `{domain}.md` 详细测试计划
4. **更新模块索引**：在本文件的"模块清单"表格中注册新模块
5. **制定测试用例**：基于 PRD/ARCH/TASK 模块，编写详细测试用例
6. **执行与记录**：执行测试并实时更新测试结果与缺陷清单
7. **发布决策**：汇总所有模块测试结果，给出发布建议

---

## 常见问题

### Q1: 如何决定测试用例拆分粒度？
**A**: 遵循以下原则：
- **需求对齐**：一个验收标准（AC）至少对应一个测试用例
- **边界覆盖**：正常场景 + 边界场景 + 异常场景
- **独立性**：测试用例之间互不依赖（可并行执行）
- **可自动化**：优先设计可自动化的测试用例

### Q2: 如何管理跨模块的端到端测试？
**A**:
- **选项1**：创建独立的"端到端测试"模块（如 `e2e-testing.md`）
- **选项2**：在主 QA 文档的"集成测试"章节统一描述
- **推荐**：选项1，便于独立维护与回归测试

### Q3: 如何处理性能测试与安全测试（跨模块）？
**A**:
- **性能测试**：创建独立模块 `performance-testing.md`，覆盖所有关键路径
- **安全测试**：创建独立模块 `security-testing.md`，基于 OWASP Top 10 制定测试计划
- **定期执行**：每个里程碑完成后执行一次全量性能/安全测试

### Q4: 如何从单一 QA 文档迁移到模块化？
**A**:
1. 保持主 `/docs/QA.md` 作为总纲
2. 按功能域逐步拆分，每个模块对应一个新文件
3. 在主文档中保留模块索引与全局测试策略
4. 历史测试记录保留在主文档，新测试写入模块文档

---

## 相关文档

- **主 QA 文档**：[/docs/QA.md](../QA.md)
- **PRD 模块索引**：[/docs/prd-modules/README.md](../prd-modules/README.md)
- **ARCH 模块索引**：[/docs/architecture-modules/README.md](../architecture-modules/README.md)
- **TASK 模块索引**：[/docs/task-modules/README.md](../task-modules/README.md)
- **追溯矩阵**：[/docs/data/traceability-matrix.md](../data/traceability-matrix.md)
- **目录规范**：[/docs/CONVENTIONS.md](../CONVENTIONS.md)

---

> **注意**：本索引文件必须与 `/docs/QA.md` 中的"模块测试索引"章节保持同步。任何模块的新增、修改、通过/失败都必须同时更新两处。
