# CR-{YYMMDD}-{序号}：{变更简要标题}

> **注意**：这是变更请求模板，创建新 CR 时复制此文件并按实际情况填写。

---

## 基本信息

| 字段 | 内容 |
|------|------|
| **CR ID** | CR-{YYMMDD}-{序号}（如 CR-20251105-001） |
| **提出人** | @username |
| **提出日期** | YYYY-MM-DD |
| **变更类型** | 需求新增 / 需求修改 / 需求删除 / 技术调整 / 合规驱动 |
| **优先级** | Critical / High / Medium / Low |
| **当前状态** | 📝 Draft |
| **关联里程碑** | M1 / M2 / M3 / （无） |

---

## 1. 变更描述

### 1.1 变更原因
（描述为什么需要这个变更，业务背景或技术背景）

**示例**：
- 用户反馈登录流程过于复杂，导致注册转化率下降 15%
- 合规部门要求增加用户数据导出功能，符合 GDPR Right to Data Portability

### 1.2 变更目标
（描述变更后期望达到的效果）

**示例**：
- 简化登录流程，提升注册转化率至 35%
- 满足 GDPR 合规要求，避免法律风险

### 1.3 变更内容
（具体描述需要修改、新增或删除的内容）

**示例**：
- 修改 US-USER-005（用户登录）的 AC-USER-005-02：删除"首次登录强制修改密码"步骤
- 新增 US-USER-012（用户数据导出）：用户可在设置页面一键导出个人数据（JSON 格式）

---

## 2. 影响范围分析

### 2.1 受影响的文档

| 文档类型 | 文档路径 | 影响章节 | 变更类型 |
|---------|---------|---------|---------|
| 主 PRD | `/docs/PRD.md` | 第 4 章：用户故事 | 修改索引 |
| 模块 PRD | `/docs/prd-modules/user-management.md` | US-USER-005 | 修改 AC |
| 追溯矩阵 | `/docs/data/traceability-matrix.md` | Story US-USER-005 | 更新 AC ID |
| 架构文档 | `/docs/ARCHITECTURE.md` | 第 5 章：数据视图 | 新增数据导出接口 |
| 任务计划 | `/docs/TASK.md` | WBS-2.3 | 调整工期 +2 天 |

### 2.2 受影响的用户故事

| Story ID | Story Title | 影响类型 | 变更说明 |
|----------|-------------|---------|---------|
| US-USER-005 | 用户登录 | 修改 | 删除 AC-USER-005-02 |
| US-USER-012 | 用户数据导出 | 新增 | 全新 Story |

### 2.3 跨模块依赖影响

| 依赖关系 | 上游模块 | 下游模块 | 影响评估 |
|---------|---------|---------|---------|
| US-USER-005 → US-PAY-001 | 用户管理 | 支付系统 | 无影响（接口不变） |
| US-USER-012 → US-ANALYTICS-003 | 用户管理 | 分析服务 | 需新增导出事件埋点 |

---

## 3. 回归测试需求

### 3.1 需要重新测试的测试用例

| Test Case ID | 原因 | 预估工时 |
|--------------|------|---------|
| TC-LOGIN-001 | AC-USER-005-02 删除 | 0.5h（更新断言） |
| TC-LOGIN-005 | 登录流程变化 | 1h（重新录制） |
| TC-PAY-001 | 验证登录前置不受影响 | 0.5h |

### 3.2 需要新增的测试用例

| Test Case ID | 测试内容 | 预估工时 |
|--------------|---------|---------|
| TC-EXPORT-001 | 验证数据导出 JSON 格式正确 | 2h |
| TC-EXPORT-002 | 验证导出数据完整性（含历史订单） | 1.5h |
| TC-EXPORT-003 | 验证导出频率限制（每天最多 3 次） | 1h |

**回归测试总工时**：约 6.5 小时

---

## 4. 技术可行性评估

### 4.1 技术方案概述
（简要描述实现方案，由 ARCH 专家或 TDD 专家填写）

**示例**：
- 数据导出功能通过后端聚合查询实现，导出格式为 JSON
- 使用 Redis 限制导出频率（用户维度：每天最多 3 次）
- 导出任务异步执行，完成后通过邮件通知用户

### 4.2 技术风险

| 风险 | 等级 | 缓解措施 |
|------|------|---------|
| 大数据量导出性能问题 | Medium | 分页导出，单次最多 10,000 条记录 |
| 导出文件包含敏感数据 | High | 脱敏处理（如隐藏支付密码、银行卡后四位） |

### 4.3 架构影响

- [ ] 需要新增 API 接口
- [x] 需要修改现有接口（登录流程）
- [ ] 需要新增数据库表
- [x] 需要修改数据库表结构（users 表新增 export_count 字段）
- [ ] 需要新增外部依赖
- [ ] 需要新增 ADR 文档

如勾选"需要新增 ADR"，请在"审批记录"章节补充 ADR 编号。

---

## 5. 工作量与时间影响

### 5.1 开发工作量估算

| 角色 | 任务 | 工时 |
|------|------|------|
| PRD 专家 | 更新 PRD 文档 | 2h |
| ARCH 专家 | 更新架构文档、评审技术方案 | 3h |
| TDD 专家 | 实现代码变更 + 单元测试 | 16h |
| QA 专家 | 编写测试用例 + 执行回归测试 | 8h |

**总工时**：29 小时（约 3.5 人天）

### 5.2 里程碑影响

- [ ] 不影响当前里程碑
- [x] 影响里程碑：M2（功能增强）
  - 原计划日期：2025-11-20
  - 调整后日期：2025-11-24（延后 4 天）

---

## 6. 审批记录

### 6.1 审批流程

| 角色 | 审批人 | 审批结果 | 审批日期 | 意见 |
|------|--------|---------|---------|------|
| PRD 专家 | @pm | 🔄 Pending | - | - |
| ARCH 专家 | @arch-lead | 🔄 Pending | - | - |
| TASK 专家 | @project-manager | 🔄 Pending | - | - |
| QA 专家 | @qa-lead | 🔄 Pending | - | - |

**审批规则**：
- Critical/High 优先级：需所有专家 ✅ Approved
- Medium 优先级：需 PRD + ARCH 专家 ✅ Approved
- Low 优先级：仅需 PRD 专家 ✅ Approved

### 6.2 审批意见汇总

#### PRD 专家意见
（待填写）

#### ARCH 专家意见
（待填写）

#### TASK 专家意见
（待填写）

#### QA 专家意见
（待填写）

---

## 7. 实施记录

### 7.1 实施清单

- [ ] 更新 `/docs/PRD.md`（主 PRD）
- [ ] 更新 `/docs/prd-modules/user-management.md`（模块 PRD）
- [ ] 更新 `/docs/data/traceability-matrix.md`（追溯矩阵）
- [ ] 更新 `/docs/ARCHITECTURE.md`（如有架构影响）
- [ ] 更新 `/docs/TASK.md`（调整任务计划）
- [ ] 新增 ADR 文档（如需要）
- [ ] 实施代码变更
- [ ] 更新测试用例
- [ ] 执行回归测试
- [ ] 更新 `/CHANGELOG.md`

### 7.2 实施人员

| 任务 | 负责人 | 完成日期 |
|------|--------|---------|
| PRD 更新 | @pm | - |
| 架构调整 | @arch-lead | - |
| 代码实现 | @developer | - |
| 测试验证 | @tester | - |

### 7.3 实施时间线

- **审批通过日期**：YYYY-MM-DD
- **预计开始日期**：YYYY-MM-DD
- **预计完成日期**：YYYY-MM-DD
- **实际完成日期**：YYYY-MM-DD

---

## 8. 验证与关闭

### 8.1 验证清单

- [ ] 所有受影响的文档已更新
- [ ] 代码变更已合并到主分支
- [ ] 所有新增测试用例已编写并通过
- [ ] 回归测试全部通过
- [ ] 无新增阻塞性缺陷
- [ ] 变更记录已写入 CHANGELOG.md

### 8.2 验证结果

| 验证项 | 结果 | 验证人 | 验证日期 | 备注 |
|--------|------|--------|---------|------|
| 功能验证 | 🔄 Pending | - | - | - |
| 回归测试 | 🔄 Pending | - | - | - |
| 文档同步 | 🔄 Pending | - | - | - |

### 8.3 关闭信息

- **关闭日期**：YYYY-MM-DD
- **关闭人**：@qa-lead
- **最终状态**：🎯 Closed / ❌ Rejected

---

## 9. 相关链接

- **关联 Issue**：[#123](issue-url)
- **关联 PR**：[#456](pr-url)
- **关联 ADR**：[001-data-export-strategy.md](../../adr/001-data-export-strategy.md)
- **讨论记录**：[Meeting Notes](meeting-url)

---

## 10. 变更历史

| 版本 | 日期 | 变更人 | 变更内容 |
|------|------|--------|---------|
| v0.1 | YYYY-MM-DD | @username | 初始版本创建 |
| v0.2 | YYYY-MM-DD | @username | 补充技术可行性评估 |

---

> **模板说明**：
> - 创建新 CR 时，将文件名改为 `CR-{YYMMDD}-{序号}.md`
> - 按实际情况填写各章节，未涉及的章节可标记为"不适用"
> - 审批流程中至少需要 PRD 专家审批通过
> - 所有变更必须在实施后更新相关文档，避免文档与代码不一致
