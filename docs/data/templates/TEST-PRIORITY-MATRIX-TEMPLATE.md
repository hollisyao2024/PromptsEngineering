# 测试用例优先级动态评分矩阵模板

> **目的**：通过量化评分机制，科学决策测试执行顺序，确保资源受限时优先执行高价值测试，最大化缺陷发现效率。

**维护者**：QA 专家
**最后更新**：2025-11-06
**版本**：v1.0

---

## 评分模型

### 综合得分公式
```
综合得分 = 关联 Story 优先级 × 2 + 覆盖范围 × 1.5 + (6 - 执行难度) × 1 + 历史缺陷率 × 0.5
```

### 评分维度说明

| 维度 | 分值范围 | 说明 | 权重 |
|------|---------|------|------|
| **关联 Story 优先级** | 1-5 | P0=5, P1=4, P2=3, P3=2, P4=1 | 2.0 |
| **覆盖范围** | 1-5 | 覆盖的功能点数量与关键路径深度 | 1.5 |
| **执行难度** | 1-5 | 测试环境复杂度与执行时间（分数越高越难） | -1.0（反向） |
| **历史缺陷率** | 1-5 | 历史上该功能发现的 P0/P1 缺陷数量 | 0.5 |

## 数据来源与阶段对齐
为了保证测试优先级评分与 PRD/ARCH/TASK 的版本保持同步，请按照下列约定填充模板字段：
- `关联 Story` 与 `Story 优先级`：直接引用 `/docs/PRD.md`（或拆分后 `/docs/prd-modules/{domain}/PRD.md`）中的 Story ID、AC 以及优先级（P0~P4），确保 Story 的业务价值与测试优先级一致。
- `覆盖范围`：参照 `/docs/ARCH.md`（或 `/docs/arch-modules/{domain}/ARCH.md`）所定义的组件、数据流、接口契约等，说明此用例覆盖的关键路径、集成点或降级场景。
- `执行难度`：结合 `/docs/TASK.md`（或 `/docs/task-modules/{domain}/TASK.md`）中的里程碑、Owner、里程碑依赖与环境准备情况，衡量环境搭建、数据准备、并发/容量等复杂度。
- `状态` 与 `执行顺序`：对齐 TASK 计划中的里程碑轮次（Round 1/2/3）、QA 预计执行窗口与负责人，便于上下游同步计划。
- 所有字段变更后，请回写 `/docs/data/traceability-matrix.md` 以记录 Story/Test Case 的最新状态（Pending/Pass/Fail/Blocked）并关联缺陷 ID。

### 优先级映射规则
| 综合得分 | 测试优先级 | 执行策略 |
|---------|----------|---------|
| ≥ 20 分 | **TP0** | 每次构建必须执行（Smoke Test） |
| 15-19 分 | **TP1** | 每日回归测试必须执行 |
| 10-14 分 | **TP2** | 每周回归测试执行 |
| < 10 分 | **TP3** | 发布前全量回归测试执行 |

---

## 测试用例优先级评分矩阵

### 1. 用户管理模块（User Management）

| 测试用例 ID | 关联 Story | 测试类型 | Story 优先级 | 覆盖范围 | 执行难度 | 历史缺陷率 | 综合得分 | 测试优先级 | 状态 |
|-----------|----------|---------|------------|---------|---------|----------|---------|----------|------|
| TC-USER-001 | US-USER-001 | E2E | 5 | 5 | 2 | 5 | **24.5** | TP0 | ✅ 通过 |
| TC-USER-002 | US-USER-001 | Unit | 5 | 3 | 1 | 5 | **21.0** | TP0 | ✅ 通过 |
| TC-USER-003 | US-USER-002 | Integration | 5 | 4 | 2 | 4 | **22.0** | TP0 | ✅ 通过 |
| TC-USER-004 | US-USER-002 | E2E | 5 | 5 | 3 | 4 | **22.5** | TP0 | ✅ 通过 |
| TC-USER-005 | US-USER-003 | E2E | 5 | 5 | 2 | 5 | **24.5** | TP0 | ✅ 通过 |
| TC-USER-006 | US-USER-003 | Performance | 5 | 4 | 3 | 3 | **19.5** | TP1 | 🔄 执行中 |
| TC-USER-007 | US-USER-003 | Security | 5 | 5 | 3 | 4 | **21.5** | TP0 | ✅ 通过 |
| TC-USER-008 | US-USER-004 | E2E | 4 | 4 | 2 | 3 | **18.5** | TP1 | 📝 待执行 |
| TC-USER-009 | US-USER-004 | Integration | 4 | 3 | 2 | 2 | **16.5** | TP1 | 📝 待执行 |
| TC-USER-010 | US-USER-004 | Unit | 4 | 2 | 1 | 2 | **15.0** | TP1 | 📝 待执行 |

### 2. 支付系统模块（Payment System）

| 测试用例 ID | 关联 Story | 测试类型 | Story 优先级 | 覆盖范围 | 执行难度 | 历史缺陷率 | 综合得分 | 测试优先级 | 状态 |
|-----------|----------|---------|------------|---------|---------|----------|---------|----------|------|
| TC-PAY-001 | US-PAY-001 | E2E | 5 | 5 | 3 | 5 | **23.5** | TP0 | 🔄 执行中 |
| TC-PAY-002 | US-PAY-001 | Integration | 5 | 4 | 2 | 5 | **22.5** | TP0 | 🔄 执行中 |
| TC-PAY-003 | US-PAY-001 | Contract | 5 | 4 | 3 | 4 | **20.0** | TP0 | 📝 待执行 |
| TC-PAY-004 | US-PAY-001 | Performance | 5 | 5 | 4 | 5 | **22.0** | TP0 | 📝 待执行 |
| TC-PAY-005 | US-PAY-002 | E2E | 5 | 5 | 2 | 5 | **24.5** | TP0 | 📝 待执行 |
| TC-PAY-006 | US-PAY-002 | Security | 5 | 5 | 3 | 5 | **23.5** | TP0 | 📝 待执行 |
| TC-PAY-007 | US-PAY-002 | Degradation | 5 | 4 | 4 | 4 | **20.0** | TP0 | 📝 待执行 |
| TC-PAY-008 | US-PAY-003 | Event-driven | 5 | 5 | 3 | 4 | **22.5** | TP0 | 📝 待执行 |
| TC-PAY-009 | US-PAY-003 | Contract | 5 | 4 | 2 | 3 | **21.0** | TP0 | 📝 待执行 |
| TC-PAY-010 | US-PAY-018 | Integration | 3 | 3 | 2 | 2 | **13.5** | TP2 | 📝 待执行 |

### 3. 通知服务模块（Notification）

| 测试用例 ID | 关联 Story | 测试类型 | Story 优先级 | 覆盖范围 | 执行难度 | 历史缺陷率 | 综合得分 | 测试优先级 | 状态 |
|-----------|----------|---------|------------|---------|---------|----------|---------|----------|------|
| TC-NOTIF-001 | US-NOTIF-001 | E2E | 5 | 5 | 2 | 4 | **23.5** | TP0 | 📝 待执行 |
| TC-NOTIF-002 | US-NOTIF-001 | Event-driven | 5 | 5 | 3 | 4 | **22.5** | TP0 | 📝 待执行 |
| TC-NOTIF-003 | US-NOTIF-001 | Contract | 5 | 4 | 2 | 3 | **21.0** | TP0 | 📝 待执行 |
| TC-NOTIF-004 | US-NOTIF-002 | E2E | 5 | 4 | 2 | 3 | **21.5** | TP0 | 📝 待执行 |
| TC-NOTIF-005 | US-NOTIF-002 | Integration | 5 | 3 | 2 | 3 | **19.5** | TP1 | 📝 待执行 |
| TC-NOTIF-006 | US-NOTIF-003 | Degradation | 4 | 5 | 3 | 4 | **20.5** | TP0 | 📝 待执行 |
| TC-NOTIF-007 | US-NOTIF-008 | Integration | 3 | 3 | 2 | 2 | **13.5** | TP2 | 📝 待执行 |
| TC-NOTIF-008 | US-NOTIF-008 | Unit | 3 | 2 | 1 | 1 | **11.5** | TP2 | 📝 待执行 |
| TC-NOTIF-009 | US-NOTIF-010 | E2E | 3 | 4 | 3 | 2 | **14.0** | TP2 | 📝 待执行 |
| TC-NOTIF-010 | US-NOTIF-010 | Integration | 3 | 3 | 2 | 1 | **12.0** | TP2 | 📝 待执行 |

**状态说明**：
- ✅ **通过**：测试执行通过，无缺陷
- 🔄 **执行中**：正在执行测试
- 📝 **待执行**：计划执行但尚未开始
- ❌ **失败**：测试执行失败，有缺陷待修复
- ⏸️ **阻塞**：依赖项未就绪，无法执行

---

## 全局优先级排序（跨模块 Top 20）

按综合得分降序排列，资源受限时优先执行：

| 排名 | 测试用例 ID | 关联 Story | 模块 | 测试类型 | 综合得分 | 测试优先级 | 执行时间 | 累计覆盖率 |
|------|-----------|----------|------|---------|---------|----------|---------|----------|
| 1 | TC-USER-001 | US-USER-001 | 用户管理 | E2E | 24.5 | TP0 | 5min | 8% |
| 2 | TC-USER-005 | US-USER-003 | 用户管理 | E2E | 24.5 | TP0 | 5min | 16% |
| 3 | TC-PAY-005 | US-PAY-002 | 支付系统 | E2E | 24.5 | TP0 | 10min | 24% |
| 4 | TC-PAY-001 | US-PAY-001 | 支付系统 | E2E | 23.5 | TP0 | 10min | 32% |
| 5 | TC-PAY-006 | US-PAY-002 | 支付系统 | Security | 23.5 | TP0 | 15min | 40% |
| 6 | TC-NOTIF-001 | US-NOTIF-001 | 通知服务 | E2E | 23.5 | TP0 | 8min | 48% |
| 7 | TC-PAY-008 | US-PAY-003 | 支付系统 | Event-driven | 22.5 | TP0 | 12min | 56% |
| 8 | TC-PAY-002 | US-PAY-001 | 支付系统 | Integration | 22.5 | TP0 | 5min | 62% |
| 9 | TC-USER-004 | US-USER-002 | 用户管理 | E2E | 22.5 | TP0 | 5min | 68% |
| 10 | TC-NOTIF-002 | US-NOTIF-001 | 通知服务 | Event-driven | 22.5 | TP0 | 10min | 74% |
| 11 | TC-PAY-004 | US-PAY-001 | 支付系统 | Performance | 22.0 | TP0 | 20min | 80% |
| 12 | TC-USER-003 | US-USER-002 | 用户管理 | Integration | 22.0 | TP0 | 3min | 84% |
| 13 | TC-USER-007 | US-USER-003 | 用户管理 | Security | 21.5 | TP0 | 10min | 88% |
| 14 | TC-NOTIF-004 | US-NOTIF-002 | 通知服务 | E2E | 21.5 | TP0 | 8min | 92% |
| 15 | TC-PAY-009 | US-PAY-003 | 支付系统 | Contract | 21.0 | TP0 | 5min | 95% |
| 16 | TC-USER-002 | US-USER-001 | 用户管理 | Unit | 21.0 | TP0 | 2min | 96% |
| 17 | TC-NOTIF-003 | US-NOTIF-001 | 通知服务 | Contract | 21.0 | TP0 | 5min | 97% |
| 18 | TC-NOTIF-006 | US-NOTIF-003 | 通知服务 | Degradation | 20.5 | TP0 | 10min | 98% |
| 19 | TC-PAY-003 | US-PAY-001 | 支付系统 | Contract | 20.0 | TP0 | 5min | 99% |
| 20 | TC-PAY-007 | US-PAY-002 | 支付系统 | Degradation | 20.0 | TP0 | 10min | 100% |

**说明**：
- **累计覆盖率**：前 N 个测试用例覆盖的关键 Story 比例（基于 Story 优先级加权）
- **执行时间**：单个测试用例的平均执行时间（含环境准备）
- 前 15 个测试用例（≤ 2 小时）可覆盖 95% 的核心功能，适合快速冒烟测试

---

## 评分细则

### 1. 关联 Story 优先级（1-5 分）

| Story 优先级 | 分值 | 说明 | 示例 Story |
|------------|------|------|-----------|
| P0 | 5 | 核心功能，必须实现且必须测试 | US-USER-001（注册）、US-PAY-001（支付） |
| P1 | 4 | 重要功能，优先实现且优先测试 | US-USER-004（密码重置）、US-PAY-018（历史查询） |
| P2 | 3 | 增值功能，资源允许时测试 | US-NOTIF-008（批量通知）、US-USER-010（头像上传） |
| P3 | 2 | 可选功能，发布前全量测试 | US-ANALYTICS-001（埋点）、US-EXPORT-001（导出） |
| P4 | 1 | 实验性功能，长期规划测试 | US-AI-001（AI 推荐）、US-THEME-001（主题切换） |

### 2. 覆盖范围（1-5 分）

| 分值 | 说明 | 示例测试用例 |
|------|------|------------|
| 5 | 覆盖完整用户流程，跨多个模块/服务 | TC-USER-001（注册流程含邮箱验证+登录） |
| 4 | 覆盖单模块的关键路径，涉及多个接口 | TC-PAY-001（创建订单流程） |
| 3 | 覆盖单个功能点的主要场景与边界条件 | TC-USER-008（密码重置正常+异常场景） |
| 2 | 覆盖单个接口的单一场景 | TC-USER-002（注册接口 - 正常情况） |
| 1 | 覆盖单个函数的单元逻辑 | TC-USER-010（密码加密函数单元测试） |

### 3. 执行难度（1-5 分）

| 分值 | 说明 | 示例测试用例 |
|------|------|------------|
| 5 | 需要复杂环境（多服务联调+外部依赖），执行时间 > 30 分钟 | TC-PAY-004（支付性能测试，需模拟高并发） |
| 4 | 需要中等复杂环境（第三方 Mock），执行时间 10-30 分钟 | TC-PAY-007（支付降级测试，需关闭支付网关） |
| 3 | 需要基础环境（数据库+API），执行时间 5-10 分钟 | TC-PAY-001（E2E 支付流程，需完整环境） |
| 2 | 需要最小环境（本地数据库），执行时间 1-5 分钟 | TC-USER-003（集成测试，仅需数据库） |
| 1 | 无外部依赖，执行时间 < 1 分钟 | TC-USER-002（单元测试，纯内存运行） |

### 4. 历史缺陷率（1-5 分）

| 分值 | 说明 | 缺陷历史 |
|------|------|---------|
| 5 | 历史上发现 3+ 个 P0/P1 缺陷 | US-PAY-002（支付确认曾出现金额错误、重复扣款） |
| 4 | 历史上发现 2 个 P0/P1 缺陷 | US-USER-002（邮箱验证曾出现链接失效） |
| 3 | 历史上发现 1 个 P0/P1 缺陷 | US-NOTIF-001（邮件通知曾出现延迟） |
| 2 | 历史上仅发现 P2 缺陷（非阻塞） | US-USER-004（密码重置曾出现提示文案错误） |
| 1 | 历史上无缺陷或仅发现 P3 缺陷 | US-NOTIF-010（新功能，无历史数据） |

**说明**：
- 新功能默认给 **1 分**，随着迭代逐步调整
- 缺陷率每个季度重新统计，反映模块稳定性

---

## 使用指南

### 1. 初始评分（QA 阶段）

QA 专家在编写测试用例时：
1. 读取 PRD 中的 Story 优先级（从 `/docs/data/priority-matrix.md`）
2. 评估测试用例的覆盖范围、执行难度
3. 查询历史缺陷率（从 `/docs/qa-modules/{module}/QA.md` 的缺陷清单）
4. 计算综合得分，确定测试优先级（TP0-TP3）
5. 在本矩阵中记录

### 2. 动态调整（Sprint 执行中）

在以下情况下重新评估测试优先级：

| 触发条件 | 调整策略 | 示例 |
|---------|---------|------|
| **Story 优先级变更** | 同步调整测试优先级 | US-USER-004 从 P2 升级为 P1 → TC-USER-008 从 TP2 升级为 TP1 |
| **发现高优先级缺陷** | 提升历史缺陷率，增加相关测试优先级 | US-PAY-002 发现 P0 缺陷 → TC-PAY-005/006 优先级提升 |
| **测试环境优化** | 降低执行难度，可能提升执行频率 | 支付网关 Mock 稳定 → TC-PAY-003 执行难度从 4 降为 3 |
| **时间压力** | 仅执行 TP0/TP1，TP2 延后到发布前 | Sprint 最后一天仅跑 Top 15 测试用例（2 小时） |

### 3. 资源受限场景下的策略

#### 策略 1: 快速冒烟测试（30 分钟）
执行前 10 个测试用例（TP0 中的 E2E + Integration），覆盖率 ≥ 80%

```bash
# 自动选择 TP0 且执行时间 ≤ 5 分钟的测试
npm run test:smoke
```

#### 策略 2: 每日回归测试（2 小时）
执行前 20 个测试用例（TP0 + 部分 TP1），覆盖率 100%

```bash
# 自动选择 TP0 和 TP1 的测试用例
npm run test:daily
```

#### 策略 3: 发布前全量测试（1 天）
执行所有测试用例（TP0-TP3），包括长时间性能测试

```bash
# 执行所有测试用例
npm run test:full
```

### 4. 关联到 QA 文档

在模块 QA 的测试用例中引用评分：

```markdown
#### TC-USER-001: 用户注册 E2E 测试

**测试类型**：E2E
**关联 Story**：US-USER-001（用户注册）
**测试优先级**：TP0（综合得分 24.5，详见 [test-priority-matrix.md](../../data/test-priority-matrix.md)）
**执行频率**：每次构建（CI Smoke Test）

**Given**：用户访问注册页面
**When**：用户填写邮箱、密码并提交
**Then**：系统创建账号并发送验证邮件
```

---

## 测试优先级分布统计

### 按测试优先级分布

| 测试优先级 | 测试用例数 | 占比 | 平均执行时间 | 累计执行时间 | 覆盖率 |
|----------|----------|------|------------|------------|--------|
| **TP0** | 20 | 67% | 8.5 分钟 | 170 分钟 | 100% |
| **TP1** | 5 | 17% | 6 分钟 | 30 分钟 | 85% |
| **TP2** | 5 | 17% | 4 分钟 | 20 分钟 | 60% |
| **TP3** | 0 | 0% | - | - | - |
| **总计** | **30** | **100%** | **7.3 分钟** | **220 分钟** | **100%** |

**说明**：
- TP0 占比 67%，反映核心功能的测试投入
- 全量回归测试需 3.7 小时，符合"1 天完成"的目标
- 快速冒烟测试（TP0 前 10 个）仅需 50 分钟，满足 CI/CD 要求

### 按模块分布

| 模块 | TP0 | TP1 | TP2 | TP3 | 总计 | 模块优先级 |
|------|-----|-----|-----|-----|------|-----------|
| **用户管理** | 7 | 3 | 0 | 0 | 10 | 高 |
| **支付系统** | 9 | 0 | 1 | 0 | 10 | 高 |
| **通知服务** | 4 | 2 | 4 | 0 | 10 | 中 |
| **总计** | **20** | **5** | **5** | **0** | **30** | - |

**说明**：
- 支付系统 TP0 占比最高（90%），反映其业务关键性
- 通知服务 TP2 占比较高（40%），可在资源紧张时适当降级

### 按测试类型分布

| 测试类型 | TP0 | TP1 | TP2 | TP3 | 总计 | 平均得分 |
|---------|-----|-----|-----|-----|------|---------|
| **E2E** | 9 | 1 | 1 | 0 | 11 | 22.8 |
| **Integration** | 4 | 2 | 2 | 0 | 8 | 18.3 |
| **Unit** | 2 | 1 | 1 | 0 | 4 | 17.4 |
| **Contract** | 3 | 0 | 0 | 0 | 3 | 21.0 |
| **Event-driven** | 2 | 0 | 0 | 0 | 2 | 22.5 |
| **Security** | 2 | 0 | 0 | 0 | 2 | 22.5 |
| **Performance** | 1 | 1 | 0 | 0 | 2 | 20.8 |
| **Degradation** | 2 | 0 | 1 | 0 | 3 | 20.2 |
| **Regression** | 0 | 0 | 0 | 0 | 0 | - |
| **总计** | **25** | **5** | **5** | **0** | **35** | **20.5** |

**说明**：
- E2E 测试平均得分最高（22.8），优先执行
- 回归测试未单独列出（回归集 = TP0 + TP1 全量执行）

---

## 动态调整机制

### 场景 1: 紧急修复（Hotfix）

**情况**：生产环境发现 P0 缺陷，需要快速验证修复。

**调整策略**：
1. 仅执行与缺陷相关的测试用例（及其依赖）
2. 执行所有 TP0 的 E2E 测试（防止回归）
3. 跳过 TP1/TP2（在下次全量回归补测）

**示例**：
```bash
# 执行 US-PAY-002 相关的所有测试
npm run test:hotfix -- --story=US-PAY-002

# 输出：
# TC-PAY-005, TC-PAY-006, TC-PAY-007 (3 个测试用例)
# + 所有 TP0 E2E 测试 (9 个测试用例)
# 总计执行 12 个测试用例（约 1 小时）
```

### 场景 2: Sprint 最后一天（时间压力）

**情况**：距离 Sprint 结束仅剩 4 小时，需要验证所有 Story。

**调整策略**：
1. 仅执行 TP0 测试用例（170 分钟 ≈ 3 小时）
2. TP1/TP2 延后到发布前全量回归
3. 记录跳过的测试用例，追踪技术债务

**示例**：
```bash
# 仅执行 TP0 测试用例
npm run test:priority -- --level=TP0

# 生成跳过报告
npm run test:report-skipped
```

### 场景 3: 新模块首次发布（风险高）

**情况**：全新模块首次上线，历史缺陷率未知。

**调整策略**：
1. 所有测试用例默认为 TP1（不低于 TP2）
2. 额外增加探索性测试（Exploratory Testing）
3. 首次发布后统计缺陷率，调整优先级

**示例**：
```bash
# 为新模块创建保守的优先级评分
npm run qa:init-priority -- --module=new-module --conservative

# 输出：
# 所有测试用例优先级 +1（TP2 → TP1, TP1 → TP0）
# 建议执行时间：全量回归 + 2 小时探索性测试
```

### 场景 4: 技术债务偿还（质量提升）

**情况**：历史模块稳定性差，需要加强测试覆盖。

**调整策略**：
1. 提升历史缺陷率高的测试用例优先级
2. 补充缺失的测试类型（如性能、安全测试）
3. 执行更频繁的回归测试（每日 → 每次构建）

**示例**：
```bash
# 分析历史缺陷，推荐优先级调整
npm run qa:analyze-defects -- --module=payment

# 输出：
# ⚠️  US-PAY-002 历史缺陷率从 4 升级为 5
# 建议：TC-PAY-005, TC-PAY-006 优先级从 TP1 升级为 TP0
```

---

## 自动化建议

### 脚本工具

```bash
# 1. 根据评分自动计算测试优先级
npm run qa:calc-test-priority

# 2. 生成测试执行计划（按优先级排序）
npm run qa:generate-test-plan

# 3. 检测优先级冲突（TP0 但执行时间过长）
npm run qa:check-priority-conflicts

# 4. 基于资源限制生成最优测试集
npm run qa:optimize-test-suite -- --time-limit=120

# 5. 分析历史缺陷率，推荐优先级调整
npm run qa:analyze-defects

# 6. 生成测试优先级报告（Markdown）
npm run qa:report-priority
```

### 示例输出

#### 1. 测试执行计划
```bash
$ npm run qa:generate-test-plan

📋 测试执行计划（基于优先级排序）

TP0 - 每次构建必须执行（20 个测试用例，170 分钟）
  1. TC-USER-001 (E2E, 5min) → US-USER-001
  2. TC-USER-005 (E2E, 5min) → US-USER-003
  3. TC-PAY-005 (E2E, 10min) → US-PAY-002
  ...

TP1 - 每日回归测试（5 个测试用例，30 分钟）
  21. TC-USER-006 (Performance, 10min) → US-USER-003
  22. TC-USER-008 (E2E, 5min) → US-USER-004
  ...

TP2 - 每周回归测试（5 个测试用例，20 分钟）
  26. TC-PAY-010 (Integration, 3min) → US-PAY-018
  27. TC-NOTIF-007 (Integration, 3min) → US-NOTIF-008
  ...

✅ 总计 30 个测试用例，预计执行时间 220 分钟
```

#### 2. 优先级冲突检测
```bash
$ npm run qa:check-priority-conflicts

⚠️  优先级冲突检测结果

TC-PAY-004: 支付性能测试
  - 测试优先级: TP0（综合得分 22.0）
  - 执行时间: 20 分钟
  - 建议: 执行时间过长，考虑降级为 TP1 或拆分为多个测试用例

TC-PAY-007: 支付降级测试
  - 测试优先级: TP0（综合得分 20.0）
  - 执行难度: 4（需要关闭支付网关）
  - 建议: 环境复杂度高，考虑降级为 TP1 或优化测试环境
```

#### 3. 资源受限下的最优测试集
```bash
$ npm run qa:optimize-test-suite -- --time-limit=120

🎯 最优测试集（时间限制 120 分钟）

选择策略：贪心算法（综合得分 / 执行时间）
覆盖率目标：≥ 95%

选中的测试用例（17 个，115 分钟）：
  1. TC-USER-001 (24.5 分 / 5min = 4.9) ✅
  2. TC-USER-005 (24.5 分 / 5min = 4.9) ✅
  3. TC-USER-002 (21.0 分 / 2min = 10.5) ✅ 最优性价比
  4. TC-USER-003 (22.0 分 / 3min = 7.3) ✅
  ...

累计覆盖率：97%（覆盖 13/13 个 P0 Story）
剩余时间：5 分钟

跳过的测试用例（13 个）：
  - TC-PAY-004 (Performance, 20min) → 延后到每日回归
  - TC-PAY-007 (Degradation, 10min) → 延后到每日回归
  ...

✅ 建议：执行选中的 17 个测试用例，跳过的 13 个在每日回归中补测
```

---

## 与其他文档的关系

```
测试优先级矩阵（test-priority-matrix.md）
  ├─ 数据来源 → PRD 优先级矩阵（/docs/data/priority-matrix.md）
  ├─ 数据来源 → 测试策略矩阵（/docs/data/test-strategy-matrix.md）
  ├─ 数据来源 → QA 模块缺陷清单（/docs/qa-modules/{module}/QA.md）
  ├─ 影响 → CI/CD 测试执行计划（.github/workflows/test.yml）
  ├─ 影响 → 测试报告生成（/docs/data/qa-reports/test-execution-report.md）
  └─ 影响 → 资源分配决策（Sprint 规划中的测试工作量评估）
```

---

## 常见问题

### Q1: 综合得分相同时如何排序？

**A**: 按以下顺序作为 tie-breaker：
1. 关联 Story 优先级高者优先（P0 > P1）
2. 覆盖范围大者优先（E2E > Integration > Unit）
3. 执行难度低者优先（更快反馈）
4. 历史缺陷率高者优先（更易发现问题）

### Q2: 如何处理长时间的性能测试？

**A**:
- **策略 1**：拆分为多个测试用例（如"登录性能 - 100 并发"、"登录性能 - 1000 并发"），分别评分
- **策略 2**：在 CI 中使用轻量级性能测试（TP0），完整性能测试放在每日回归（TP1）
- **策略 3**：使用并行执行（多机分布式测试），缩短总执行时间

### Q3: 新功能的历史缺陷率如何设置？

**A**:
- **默认值**：1 分（无历史数据）
- **参考依据**：
  - 类似功能的历史缺陷率（如新支付方式参考已有支付方式）
  - 技术风险高的功能，初始给 2-3 分（保守估计）
  - 稳定模块的新增功能，保持 1 分
- **调整时机**：首次发布后，根据实际缺陷数量调整

### Q4: 如何平衡测试覆盖率与执行时间？

**A**: 使用"累计覆盖率"指标：
- **快速反馈（30 分钟）**：执行前 10 个测试用例，覆盖率 ≥ 80%
- **每日回归（2 小时）**：执行前 20 个测试用例，覆盖率 100%
- **发布前全量（1 天）**：执行所有测试用例，覆盖率 100% + 长尾场景

建议：使用 `npm run qa:optimize-test-suite` 自动生成时间限制下的最优测试集。

### Q5: 测试优先级矩阵需要多久更新一次？

**A**:
- **实时更新**：Story 优先级变更时同步更新
- **每周更新**：统计新发现的缺陷，调整历史缺陷率
- **每季度更新**：全面评估所有维度，清理过时数据

---

## 评分审计日志

| 日期 | 测试用例 ID | 变更项 | 变更前 | 变更后 | 变更原因 | 变更人 |
|------|-----------|--------|--------|--------|---------|--------|
| 2025-11-06 | TC-USER-006 | 历史缺陷率 | 2 | 3 | US-USER-003 发现 1 个 P1 缺陷 | @qa-tester-1 |
| 2025-11-10 | TC-PAY-004 | 执行难度 | 4 | 3 | 性能测试环境优化，执行时间从 30min 缩短为 20min | @qa-perf-lead |
| 2025-11-12 | TC-PAY-005 | 测试优先级 | TP1 | TP0 | US-PAY-002 升级为 P0，相关测试同步升级 | @prd-owner |
| （待填充） | - | - | - | - | - | - |

---

> 本文件由 QA 专家维护，TDD 专家在 CI/CD 配置时引用。测试优先级是动态的，应随 Story 优先级、缺陷发现、环境优化而定期更新。
