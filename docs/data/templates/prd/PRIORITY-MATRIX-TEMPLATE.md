# 需求优先级动态评分矩阵

> **目的**：通过量化评分机制，科学决策需求优先级，减少主观判断，确保资源分配合理。

---

## 评分模型

### 综合得分公式
```
综合得分 = 业务价值 × 2 + 用户影响面 × 1.5 + (6 - 技术风险) × 1 + 依赖权重 × 0.5
```

### 评分维度说明

| 维度 | 分值范围 | 说明 | 权重 |
|------|---------|------|------|
| **业务价值** | 1-5 | 对公司 KPI/OKR 的贡献度 | 2.0 |
| **用户影响面** | 1-5 | 受益用户比例或使用频率 | 1.5 |
| **技术风险** | 1-5 | 实现复杂度和不确定性（分数越高风险越大） | -1.0（反向） |
| **依赖权重** | 自动计算 | 被依赖次数 × 2 + 依赖层级深度 | 0.5 |

### 优先级映射规则
| 综合得分 | 优先级 | 说明 |
|---------|--------|------|
| ≥ 20 分 | **P0** | 核心功能，必须实现 |
| 15-19 分 | **P1** | 重要功能，优先实现 |
| 10-14 分 | **P2** | 增值功能，资源允许时实现 |
| < 10 分 | **P3** | 可选功能，长期规划 |

---

## 评分矩阵

| Story ID | Story Title | 业务价值 | 用户影响面 | 技术风险 | 依赖权重 | 综合得分 | 建议优先级 | 当前优先级 | 状态 |
|----------|-------------|---------|-----------|---------|---------|---------|-----------|-----------|------|
| US-USER-001 | 用户注册 | 5 | 5 | 2 | 8 | **27.5** | P0 | P0 | ✅ 已确认 |
| US-USER-002 | 邮箱验证 | 4 | 5 | 1 | 6 | **25.5** | P0 | P0 | ✅ 已确认 |
| US-USER-003 | 用户登录 | 5 | 5 | 2 | 10 | **29.0** | P0 | P0 | ✅ 已确认 |
| US-PAY-001 | 创建支付订单 | 5 | 4 | 3 | 4 | **21.0** | P0 | P0 | 🔄 开发中 |
| US-PAY-002 | 支付确认 | 5 | 4 | 3 | 2 | **19.0** | P1 | P0 | 🔄 开发中 |
| US-USER-004 | 密码重置 | 3 | 3 | 2 | 0 | **14.5** | P2 | P1 | 📝 待启动 |
| US-NOTIF-001 | 邮件通知 | 4 | 5 | 2 | 4 | **22.5** | P0 | P0 | 📝 待启动 |
| US-ANALYTICS-001 | 用户行为埋点 | 3 | 2 | 3 | 0 | **12.0** | P2 | P1 | 📝 待启动 |
| US-PAY-004 | 支付历史查询 | 2 | 3 | 1 | 0 | **12.5** | P2 | P2 | 📝 待启动 |

**说明**：
- ⚠️ **黄色高亮**：建议优先级与当前优先级不一致，需重新评估
- ✅ **已确认**：Story 已完成并通过验证
- 🔄 **开发中**：正在实施
- 📝 **待启动**：计划中但尚未开始

---

## 评分细则

### 1. 业务价值（1-5 分）

| 分值 | 说明 | 示例 |
|------|------|------|
| 5 | 直接影响核心 KPI，无此功能业务无法运行 | 用户注册、支付订单 |
| 4 | 对 KPI 有显著贡献，可量化提升业务指标 | 推荐系统、优惠券 |
| 3 | 对 KPI 有一定贡献，间接影响业务目标 | 数据分析、埋点 |
| 2 | 对 KPI 影响较小，主要为体验优化 | 深色模式、动画效果 |
| 1 | 对 KPI 几乎无影响，锦上添花 | 彩蛋功能、节日主题 |

### 2. 用户影响面（1-5 分）

| 分值 | 说明 | 示例 |
|------|------|------|
| 5 | 100% 用户必经流程，每日多次使用 | 登录、搜索、支付 |
| 4 | 80%+ 用户会使用，每周多次使用 | 个人资料、订单查询 |
| 3 | 50%+ 用户会使用，每月多次使用 | 客服反馈、设置修改 |
| 2 | 20%+ 用户会使用，偶尔使用 | 高级设置、导出数据 |
| 1 | < 10% 用户使用，极少使用 | 管理员功能、开发者工具 |

### 3. 技术风险（1-5 分）

| 分值 | 说明 | 示例 |
|------|------|------|
| 5 | 技术方案不明确，需大量调研或 PoC | AI 推荐算法、区块链集成 |
| 4 | 涉及复杂第三方集成，依赖外部稳定性 | 支付网关、OAuth 第三方登录 |
| 3 | 需要重构现有架构或引入新技术栈 | 微服务拆分、数据库迁移 |
| 2 | 技术方案成熟，但实现工作量较大 | CRUD 功能、报表生成 |
| 1 | 技术简单，可复用现有组件 | UI 文案调整、配置修改 |

### 4. 依赖权重（自动计算）

#### 计算公式
```
依赖权重 = 被依赖次数 × 2 + 依赖层级深度 × 1
```

#### 示例
- **US-USER-003（登录）**：
  - 被 5 个 Story 依赖（US-PAY-001, US-USER-004, US-USER-005, US-ANALYTICS-001, US-NOTIF-002）
  - 依赖层级深度 = 2（US-USER-001 → US-USER-002 → US-USER-003）
  - 依赖权重 = 5 × 2 + 2 = **12**

- **US-ANALYTICS-001（埋点）**：
  - 被 0 个 Story 依赖
  - 依赖层级深度 = 0
  - 依赖权重 = 0 × 2 + 0 = **0**

---

## 使用指南

### 1. 初始评分（PRD 阶段）
PRD 专家在编写用户故事时：
1. 为每个 Story 评估业务价值、用户影响面、技术风险
2. 从依赖关系图中提取依赖权重
3. 计算综合得分，确定建议优先级
4. 在本矩阵中记录

### 2. 动态调整（Sprint 规划前）
每个 Sprint 开始前，重新评估：
- **业务目标变化**：KPI 调整导致业务价值变化
- **用户反馈**：高频抱怨的功能提升用户影响面
- **技术方案明确**：PoC 完成后降低技术风险
- **依赖关系变化**：新增 Story 导致依赖权重变化

### 3. 优先级冲突解决
当建议优先级与当前优先级不一致时：
1. PRD 专家组织评审会
2. 多专家投票（PRD、ARCH、TASK、业务代表）
3. 达成共识后更新"当前优先级"列
4. 在变更记录中说明调整原因

### 4. 关联到 PRD 文档
在模块 PRD 的每个 Story 中引用评分：

```markdown
### US-USER-001: 用户注册
**作为** 新用户
**我希望** 通过邮箱和密码注册账号
**以便** 使用平台服务

**优先级**：P0（综合得分 27.5，详见 [priority-matrix.md](../data/priority-matrix.md)）
**依赖**：无
```

---

## 评分审计日志

| 日期 | Story ID | 变更项 | 变更前 | 变更后 | 变更原因 | 变更人 |
|------|---------|--------|--------|--------|---------|--------|
| 2025-11-05 | US-USER-004 | 当前优先级 | P2 | P1 | 用户反馈密码重置需求强烈 | @pm |
| 2025-11-08 | US-PAY-002 | 技术风险 | 4 | 3 | 支付网关集成 PoC 完成 | @arch-lead |
| （待填充） | - | - | - | - | - | - |

---

## 自动化建议

### 脚本工具
```bash
# 根据依赖关系图自动计算依赖权重
npm run priority:calc-dependency

# 根据评分矩阵生成优先级建议报告
npm run priority:report

# 检测优先级冲突（建议 ≠ 当前）
npm run priority:check-conflicts
```

### 示例输出
```
⚠️  优先级冲突检测结果

US-USER-004: 密码重置
  - 建议优先级: P2（综合得分 14.5）
  - 当前优先级: P1
  - 建议: 考虑降级为 P2 或重新评估用户影响面

US-ANALYTICS-001: 用户行为埋点
  - 建议优先级: P2（综合得分 12.0）
  - 当前优先级: P1
  - 建议: 如当前 Sprint 资源紧张，可延后到下个 Sprint
```

---

## 与其他文档的关系

```
优先级矩阵（priority-matrix.md）
  ├─ 数据来源 → PRD 模块（/docs/prd-modules/{domain}/PRD.md）
  ├─ 数据来源 → 依赖关系图（dependency-graph.md）
  ├─ 影响 → 任务规划（/docs/TASK.md）的 WBS 排序
  ├─ 影响 → Sprint Backlog 排序
  └─ 影响 → 资源分配决策
```

---

## 常见问题

### Q1: 综合得分相同时如何排序？
**A**: 按以下顺序作为 tie-breaker：
1. 业务价值高者优先
2. 依赖权重高者优先（阻塞其他 Story）
3. 技术风险低者优先（更快交付）

### Q2: 如何处理"紧急但不重要"的需求？
**A**: 引入"紧急度"维度（不计入综合得分）：
- 🔥 **Critical**：安全漏洞、法律合规，立即响应
- ⚡ **Urgent**：客户投诉、竞品压力，1 周内响应
- 📅 **Normal**：按综合得分排序

### Q3: 评分是否需要多人投票？
**A**: 建议采用 Planning Poker 方式：
1. 每位专家独立评分
2. 取中位数或平均值
3. 差异过大时讨论达成共识

### Q4: 评分矩阵太长怎么办？
**A**: 按模块分组，创建模块级优先级矩阵：
- `/docs/data/priority-matrix-user.md`（用户管理模块）
- `/docs/data/priority-matrix-payment.md`（支付系统模块）

主矩阵仅包含 P0/P1 Story 的跨模块对比。

---

> 本文件由 PRD 专家维护，TASK 专家在 Sprint 规划时引用。优先级评分是动态的，应随业务目标和技术方案变化定期更新。
